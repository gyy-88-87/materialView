
(function($){$.fn.combobox=function(data,config){var keys={up:38,down:40,enter:13,tab:9,esc:27};var initKey='combobox_initialized';config=$.extend({imageUrl:'dropdown.gif'},config);$(this).each(function(i){var textBox=$(this);if($.data(this,initKey))
return;$.data(this,initKey,true);textBox.attr('autocomplete','off').focus(function(){show('');}).blur(blur).keydown(keydown).keyup(keyup);var container=textBox.wrap('<div class="combobox" />').parent().css('zIndex',1000-i);var button=$('<img class="button" src="'+config.imageUrl+'" />').appendTo(container).css({top:1,left:textBox.width(),height:textBox.height()+3}).click(function(){textBox.focus();});var select;var oriValue;function show(filter){oriValue=textBox.val();hide();var html='<ul class="select">';for(var k in data){var v=data[k];if((!filter)||(filter&&v.indexOf(filter)>=0)){html+='<li>'+v+'</li>';}}
html+='</ul>';select=$(html).appendTo(container).css({left:0,top:textBox.height()+3,width:textBox.width()+button.width()-2});if(select.bgiframe)
select.bgiframe();selIndex=0;var found=false;var options=select.children('li').each(function(i){if(found)return;if($(this).text()==oriValue){$(this).addClass('selected');selIndex=i;found=true;}});if(!options.size()){hide();return;}
if(!found)
options.eq(0).addClass('selected');options.click(function(){textBox.val($(this).text());}).hover(function(){options.each(function(){$(this).removeClass('selected');});$(this).addClass('selected');selIndex=options.index(this);},function(){$(this).removeClass('selected');});$(document).click(pageClick);if(!filter)
select.slideDown();else
select.show();}
var selIndex;function keydown(evt){switch(evt.keyCode){case keys.esc:hide();textBox.val(oriValue);evt.preventDefault();return;case keys.enter:choose();evt.preventDefault();return;case keys.tab:choose();return;case keys.up:goup();return;case keys.down:godown();return;}}
function godown(){if(select){var options=select.children('li');var n=options.size();if(!n)
return;selIndex++;if(selIndex>n-1)
selIndex=0;var v=options.eq(selIndex);if(v.size()){options.each(function(){$(this).removeClass('selected')});v.addClass('selected');}}else{show('');}}
function goup(){if(select){var options=select.children('li');var n=options.size();if(!n)
return;selIndex--;if(selIndex<0)
selIndex=n-1;var v=options.eq(selIndex);if(v.size()){options.each(function(){$(this).removeClass('selected')});v.addClass('selected');}}else{show('');}}
function choose(){if(select){var v=$('li',select).eq(selIndex);if(v.size()){textBox.val(v.text());oldVal=v.text();hide();}}}
var oldVal='';function keyup(evt){var v=$(this).val();if(v!=oldVal){show(oldVal=v);}}
function hide(){if(select){if(hideTimeout){window.clearTimeout(hideTimeout);hideTimeout=0;}
$(document).unbind('click',pageClick);select.remove();select=null;}}
var hideTimeout;function blur(){$(document).unbind('click',pageClick);hideTimeout=window.setTimeout(hide,200);}
function pageClick(evt){if(evt.target!=textBox[0]&&evt.target!=button[0])
hide();}});};})(jQuery);